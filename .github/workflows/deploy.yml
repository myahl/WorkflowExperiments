name: 'Deploy'
on: ['deployment']

jobs:
  deployment:
    runs-on: 'ubuntu-latest'
    steps:
    - name: Update Deliverybot Status - Pending
      uses: deliverybot/deployment-status@v1.1.1
      with:
        state: 'pending'
        token: '${{ github.token }}'

    - name: 'Checkout'
      uses: 'actions/checkout@v2'
    - run: git fetch --depth=1 origin +refs/tags/*:refs/tags/*

    - name: Payload Info
      id: payload
      uses: Dovyski/payload-info-action@v1

    - name: Set variables
      uses: actions/github-script@0.5.0
      id: vars
      with:
        script: |
          const branch = context.payload.deployment.payload.branch;
          const version = context.payload.deployment.payload.version;
          return context.payload.deployment.payload;

    - name: Echo vars
      run: |
        echo ${{ steps.vars.outputs.result }}
        echo ${{ steps.payload.outputs.value }}
        echo ${{ steps.payload.outputs.branch }}

    - name: Update Deliverybot Status - Success
      if: success()
      uses: 'deliverybot/deployment-status@v1.1.1'
      with:
        state: 'success'
        token: '${{ github.token }}'

    - name: Update Deliverybot Status - Failure
      if: failure()
      uses: 'deliverybot/deployment-status@v1.1.1'
      with:
        state: 'failure'
        token: '${{ github.token }}'